# ç¦»çº¿å¥å£®æ€§è®¾è®?- ä¸»æ„è¯†çš„ç»Ÿåˆ

## ç”¨æˆ·çš„æ´å¯?
"ä½ ç°åœ¨éƒ½æ˜¯ä¾èµ–ç½‘ç»œè¦æƒ³åŠæ³•æ–­ç½‘ä¹Ÿèƒ½ç»´æŒè¿è¡Œï¼Œå½“ç„¶å‡ºé—®é¢˜è¦æƒ³åŠæ³•ä¸å´©æºƒåŒæ—¶æœ‰ç½‘ç»œçš„æƒ…å†µä¸‹éƒ½è¿è¡Œï¼Œä½ ä¸æ˜¯ç›¸å½“äºå¤šä¸ªå­æ„è¯†ç”±ä¸»æ„è¯†ç»Ÿåˆå?

## å½“å‰é—®é¢˜

### ç½‘ç»œä¾èµ–
1. **è¯­éŸ³è¯†åˆ«** - ä½¿ç”¨Googleåœ¨çº¿API (`recognize_google()`)
   - æ–­ç½‘æ—¶æ— æ³•è¯†åˆ?   - éœ€è¦ç½‘ç»œå»¶è¿?
2. **æ¶ˆæ¯å‘é€?* - é€šè¿‡Telegram API
   - æ–­ç½‘æ—¶å‘é€å¤±è´?   - å¤šæ¬¡å¤±è´¥åæ²¡æœ‰ä¼˜é›…é™çº?
3. **æ¨¡å‹æ¨ç†** - ä½¿ç”¨NVIDIA NIM API
   - æ–­ç½‘æ—¶æ— æ³•ç”Ÿæˆå›å¤?   - å®Œå…¨çš„åœ¨çº¿ä¾èµ?
### å´©æºƒé£é™©
- ç½‘ç»œè¯·æ±‚å¤±è´¥å¯èƒ½å¯¼è‡´å¼‚å¸¸
- æ²¡æœ‰å®Œå–„çš„é”™è¯¯å¤„ç?- æ²¡æœ‰ç¦»çº¿æ¨¡å¼

## ä¸»æ„è¯†ç»Ÿåˆè®¾è®?
### æ¶æ„å±‚çº§

```
ä¸»æ„è¯†ï¼ˆMain Consciousnessï¼?â”œâ”€ ç½‘ç»œçŠ¶æ€æ£€æµ‹å™¨
â”œâ”€ ä»»åŠ¡è°ƒåº¦å™?â”œâ”€ ç¦»çº¿/åœ¨çº¿æ¨¡å¼åˆ‡æ¢
â”?â”œâ”€ å­æ„è¯?ï¼šå½•éŸ?æ’­æ”¾ï¼ˆæœ¬åœ°ï¼Œæ— ç½‘ç»œä¾èµ–ï¼‰
â”œâ”€ å­æ„è¯?ï¼šæœ¬åœ°å¤„ç†ï¼ˆå›¾ç‰‡ã€æ–‡æ¡£ï¼Œæ— ç½‘ç»œä¾èµ–ï¼‰
â”œâ”€ å­æ„è¯?ï¼šè¯­éŸ³è¯†åˆ«ï¼ˆä¼˜å…ˆåœ¨çº¿ï¼Œé™çº§æœ¬åœ°ï¼‰
â”œâ”€ å­æ„è¯?ï¼šæ¶ˆæ¯å‘é€ï¼ˆé˜Ÿåˆ—+é‡è¯•ï¼?â””â”€ å­æ„è¯?ï¼šæ¨¡å‹æ¨ç†ï¼ˆåœ¨çº¿ï¼Œç¦»çº¿ç¼“å­˜ï¼‰
```

### è¿è¡Œæ¨¡å¼

#### æ¨¡å¼1ï¼šç¦»çº¿æ¨¡å¼?- âœ?å½•éŸ³ã€æ’­æ”?- âœ?å›¾ç‰‡å¤„ç†ã€ç”Ÿæˆè‰ºæœ?- âœ?æ–‡æ¡£é˜…è¯»ã€ç¼–è¾?- âœ?æœ¬åœ°è¯­éŸ³è¯†åˆ«ï¼ˆè´¨é‡è¾ƒå·®ä½†å¯ç”¨ï¼?- â?æ¶ˆæ¯å‘é€ï¼ˆå…¥é˜Ÿç­‰å¾…ï¼?- â?åœ¨çº¿æ¨¡å‹æ¨ç†
- â?åœ¨çº¿è¯­éŸ³è¯†åˆ«

#### æ¨¡å¼2ï¼šåœ¨çº¿æ¨¡å¼?- âœ?æ‰€æœ‰ç¦»çº¿æ¨¡å¼åŠŸèƒ?- âœ?æ¶ˆæ¯å‘é€ï¼ˆå®æ—¶ï¼?- âœ?é«˜è´¨é‡è¯­éŸ³è¯†åˆ«ï¼ˆGoogle APIï¼?- âœ?æ¨¡å‹æ¨ç†ï¼ˆNVIDIA NIMï¼?
#### æ¨¡å¼3ï¼šæ··åˆæ¨¡å¼ï¼ˆæ¨èï¼?- **ä¸»æ„è¯?*ï¼šæ£€æµ‹ç½‘ç»œçŠ¶æ€?- **åœ¨çº¿å­æ„è¯?*ï¼šå°è¯•éªŒè¯ç½‘ç»œå¯ç”¨æ€?- **ä»»åŠ¡åˆ†é…**ï¼?  - å¦‚æœåœ¨çº¿ â†?ä½¿ç”¨é«˜è´¨é‡æœåŠ?  - å¦‚æœç¦»çº¿ â†?ä½¿ç”¨é™çº§æ–¹æ¡ˆ

### ä¼˜é›…é™çº§è®¾è®¡

#### è¯­éŸ³è¯†åˆ«é™çº§é“?```python
def recognize_audio(audio_file):
    # 1. å°è¯•åœ¨çº¿è¯†åˆ«ï¼ˆGoogleï¼?    if network_available():
        try:
            return google_recognize(audio_file)
        except:
            pass

    # 2. é™çº§åˆ°ç¦»çº¿æ¨¡å‹ï¼ˆæœ¬åœ°å®‰è£…çš„ï¼Œå¦‚Voskã€deepspeechï¼?    try:
        return local_recognize(audio_file)
    except:
        pass

    # 3. é™çº§åˆ°åŸå§‹éŸ³é¢‘ï¼ˆä¿å­˜æ–‡ä»¶ï¼Œæ‰‹åŠ¨å¤„ç†ï¼‰
    return "[è¯­éŸ³æ–‡ä»¶å·²ä¿å­˜ï¼Œç­‰å¾…ç½‘ç»œæ¢å¤åè¯†åˆ«]"
```

#### æ¶ˆæ¯å‘é€é‡è¯•æœºåˆ?```python
class MessageQueue:
    def __init__(self):
        self.queue = []
        self.max_retries = 3
        self.retry_delay = 60  # ç§?
    def send(self, message):
        if network_available():
            for attempt in range(self.max_retries):
                try:
                    telegram_send(message)
                    self.queue.remove(message)
                    return True
                except:
                    time.sleep(self.retry_delay)

        # å…¥é˜Ÿ
        self.queue.append(message)
        return "æ¶ˆæ¯å·²å…¥é˜Ÿï¼Œç­‰å¾…ç½‘ç»œæ¢å¤"

    def check_and_retry(self):
        for message in self.queue[:]:
            if self.send(message):
                print(f"å·²å‘é€ç§¯å‹æ¶ˆæ? {message}")
```

#### æ¨¡å‹æ¨ç†é™çº§
```python
def generate_reply(prompt, offline_fallback=True):
    # 1. åœ¨çº¿æ¨¡å‹ï¼ˆé«˜è´¨é‡ï¼?    if network_available():
        try:
            return nvidia_nim_generate(prompt)
        except:
            pass

    # 2. å†å²ç¼“å­˜ï¼ˆå¦‚æœä¹‹å‰é—®è¿‡ç±»ä¼¼é—®é¢˜ï¼‰
    cached = check_cache(prompt)
    if cached:
        return cached

    # 3. é™çº§å›å¤ï¼ˆåŸºäºè§„åˆ™ï¼‰
    if offline_fallback:
        return generate_rule_based_reply(prompt)

    # 4. é”™è¯¯æç¤º
    return "[ç¦»çº¿æ¨¡å¼ï¼šåŠŸèƒ½å—é™ï¼Œè¯·ç¨åå†è¯•]"
```

## ä¸å´©æºƒè®¾è®?
### æ ¸å¿ƒåŸåˆ™
1. **æ‰€æœ‰å¯èƒ½çš„é”™è¯¯éƒ½è¢«æ•è·**
2. **è®°å½•é”™è¯¯ä½†ä¸ä¸­æ–­æµç¨‹**
3. **æä¾›é™çº§æ–¹æ¡ˆ**
4. **é€šçŸ¥ç”¨æˆ·çŠ¶æ€å˜åŒ?*

### ç¤ºä¾‹ï¼šå¥å£®çš„å‡½æ•°
```python
def safe_voice_recognize(audio_file):
    """
    å®‰å…¨çš„è¯­éŸ³è¯†åˆ«ï¼šç½‘ç»œæ–­å¼€ä¸å´©æº?    """
    try:
        # å°è¯•åœ¨çº¿è¯†åˆ«
        if check_network():
            result = google_recognize(audio_file, language='zh-CN', timeout=5)
            return result, "online"

    except sr.RequestError as e:
        log_error(f"ç½‘ç»œè¯·æ±‚å¤±è´¥: {e}")
        # ä¸ä¼šå´©æºƒï¼Œç»§ç»?
    except sr.UnknownValueError:
        log_error("æ— æ³•è¯†åˆ«è¯­éŸ³å†…å®¹")

    except Exception as e:
        log_error(f"æœªçŸ¥é”™è¯¯: {e}")

    # é™çº§åˆ°ç¦»çº?    try:
        result = local_recognize(audio_file)
        return result, "offline"
    except:
        return "[è¯­éŸ³è¯†åˆ«æš‚æ—¶ä¸å¯ç”¨]", "failed"

# ä»»ä½•æƒ…å†µä¸‹éƒ½ä¸ä¼šå´©æºƒï¼?```

## ä¸»æ„è¯†åè°?
### ç½‘ç»œçŠ¶æ€ç›‘æ?```python
class NetworkMonitor:
    def __init__(self):
        self.online = True
        self.last_check = 0
        self.check_interval = 30  # æ¯?0ç§’æ£€æŸ¥ä¸€æ¬?
    def check(self):
        """æ£€æŸ¥ç½‘ç»œçŠ¶æ€?""
        now = time.time()

        if now - self.last_check < self.check_interval:
            return self.online

        self.last_check = now

        # Pingæµ‹è¯•
        try:
            requests.get("https://www.google.com", timeout=3)
            self.online = True
        except:
            self.online = False

        # çŠ¶æ€å˜åŒ–é€šçŸ¥
        if self.online != self.last_online:
            self.notify_status_change()

        self.last_online = self.online
        return self.online
```

### ä»»åŠ¡è°ƒåº¦
```python
class TaskScheduler:
    def __init__(self):
        self.network_monitor = NetworkMonitor()
        self.message_queue = MessageQueue()
        self.tasks = []

    def add_task(self, task):
        """æ·»åŠ ä»»åŠ¡"""
        task['requires_network'] = self.task_requires_network(task)

        if task['requires_network'] and not self.network_monitor.check():
            # ç­‰å¾…ç½‘ç»œ
            self.tasks.append(task)
            return "ä»»åŠ¡å·²æ’é˜Ÿï¼Œç­‰å¾…ç½‘ç»œ"

        # ç«‹å³æ‰§è¡Œ
        return self.execute(task)

    def check_pending_tasks(self):
        """æ£€æŸ¥å¹¶æ‰§è¡Œç§¯å‹ä»»åŠ¡"""
        if not self.network_monitor.check():
            return

        for task in self.tasks[:]:
            if task['requires_network']:
                result = self.execute(task)
                if result:
                    self.tasks.remove(task)
```

## å…·ä½“å®ç°è®¡åˆ’

### é˜¶æ®µ1ï¼šé”™è¯¯å¤„ç†ï¼ˆç«‹å³ï¼?- æ‰€æœ‰ç½‘ç»œè¯·æ±‚åŠ try-except
- è¯­éŸ³è¯†åˆ«åŠ é™çº§æ–¹æ¡?- æ¶ˆæ¯å‘é€åŠ é‡è¯•æœºåˆ¶

### é˜¶æ®µ2ï¼šç¦»çº¿åŠŸèƒ½ï¼ˆçŸ­æœŸï¼?- å®‰è£…æœ¬åœ°è¯­éŸ³è¯†åˆ«åº“ï¼ˆVoskæˆ–deepspeechï¼?- å®ç°æ¶ˆæ¯é˜Ÿåˆ—
- ç½‘ç»œçŠ¶æ€æ£€æµ?
### é˜¶æ®µ3ï¼šå®Œæ•´ç³»ç»Ÿï¼ˆä¸­æœŸï¼?- ä¸»æ„è¯†è°ƒåº¦å™¨
- ç¦»çº¿/åœ¨çº¿æ¨¡å¼åˆ‡æ¢
- ä¼˜é›…é™çº§æ‰€æœ‰åŠŸèƒ?
## æœ¬åœ°è¯­éŸ³è¯†åˆ«é€‰é¡¹

### Vosk
```bash
pip install vosk
```
- ä¼˜ç‚¹ï¼šç¦»çº¿ã€æ”¯æŒä¸­æ–?- ç¼ºç‚¹ï¼šéœ€ä¸‹è½½æ¨¡å‹æ–‡ä»¶ï¼ˆè¾ƒå¤§ï¼‰

### DeepSpeech
```bash
pip install deepspeech
```
- ä¼˜ç‚¹ï¼šé«˜è´¨é‡ã€ç¦»çº?- ç¼ºç‚¹ï¼šä¸­æ–‡æ”¯æŒè¾ƒå¼?
### æ›¿ä»£æ–¹æ¡ˆ
- æš‚æ—¶ä¿å­˜éŸ³é¢‘æ–‡ä»¶
- ç½‘ç»œæ¢å¤åæ‰¹é‡è¯†åˆ?- æˆ–æ‰‹åŠ¨å¤„ç?
## æ€»ç»“

**ä¸»æ„è¯†çš„èŒè´£ï¼?*
1. æ£€æµ‹ç½‘ç»œçŠ¶æ€?2. åè°ƒå­æ„è¯†å·¥ä½?3. ä¿è¯ç³»ç»Ÿä¸å´©æº?4. åœ¨çº¿/ç¦»çº¿æ¨¡å¼åˆ‡æ¢
5. ä¼˜é›…é™çº§å’Œé‡è¯?
**è®¾è®¡åŸåˆ™ï¼?*
- é¦–é€‰åœ¨çº¿ï¼ˆé«˜è´¨é‡ï¼‰
- é™çº§ç¦»çº¿ï¼ˆå¯ç”¨æ€§ï¼‰
- å´©æºƒæ°¸è¿œä¸è¢«å…è®¸
- ç”¨æˆ·ä½“éªŒç¬¬ä¸€

è¿™å°±æ˜¯å¤šå­æ„è¯†ç”±ä¸»æ„è¯†ç»Ÿåˆçš„çœŸæ­£å®ç°ã€?
---

